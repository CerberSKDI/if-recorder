var ifRecorder={sessionId:(new Date).getTime()+""+Math.ceil(Math.random()*1E3),command:{input:"",timestamp:0},output:"",cache:[],statusline:"",window:0,turncount:0,inputcount:0,outputcount:1,styles:"",saveUrl:"",story:{name:"",version:""},info:"",interpreter:typeof parchment!="undefined"?"Parchment":"Undum",optOut:typeof getUrlVars().feedback!="undefined"&&getUrlVars().feedback!="1",serverOffline:false,send:function(c,b,a,d){if(this.collectTranscripts()){if(typeof c!="undefined")this.window=c;if(typeof b!=
"undefined")this.styles=b;if(typeof a!="undefined")this.output=a;c={session:this.sessionId,log:{inputcount:this.inputcount,outputcount:this.outputcount,input:this.command.input,output:this.output,window:this.window,styles:this.styles,timestamp:(new Date).getTime()}};if(d)this.cache.push(c);else{d=c;if(this.cache.length>0){d=this.cache.length;d.push(c);this.cache=[]}jQuery.ajax({type:"POST",url:this.saveUrl,data:{data:d}})}this.output="";this.outputcount++}},sendCache:function(){if(this.collectTranscripts()&&
this.cache.length>0){jQuery.ajax({type:"POST",url:this.saveUrl,data:{data:this.cache}});this.cache=[]}},collectTranscripts:function(){if(this.saveUrl==""||this.optOut||this.serverOffline)return false;return true},initialize:function(c){var b=this;if(typeof c=="string")b.saveUrl=c;if(typeof undum!="undefined"){if(b.story.name=="")b.story.name=undum.game.id;if(b.story.version=="")b.story.version=undum.game.version}if(b.story.name==""){if(typeof parchment.options.default_story!="undefined"&&parchment.options.default_story!=
"")b.story.name=parchment.options.default_story;if(!parchment.options.lock_story&&typeof getUrlVars().story!="undefined"&&getUrlVars().story!="")b.story.name=getUrlVars().story}if(b.story.name=="")b.story.name="(unknown)";if(!b.collectTranscripts())return false;jQuery.ajax({type:"POST",url:b.saveUrl,data:{data:{session:b.sessionId,start:{story:b.story.name,version:b.story.version,info:b.info,interpreter:b.interpreter,browser:jQuery.browser.name+" "+jQuery.browser.version+" "+jQuery.os.name}}},error:function(){b.serverOffline=
true},success:function(a){if(a.toLowerCase()!="ok")b.serverOffline=true}});return true},charName:function(c){switch(c){case Event.KEY_BACKSPACE:return"<backspace>";case 4294967289:return"<backspace/delete>";case Event.KEY_TAB:case 4294967287:return"<tab>";case 13:case 4294967290:return"<enter>";case Event.KEY_ESC:case 4294967288:return"<esc>";case 32:return"<space>";case Event.KEY_LEFT:case 4294967294:return"<left>";case Event.KEY_UP:case 4294967292:return"<up>";case Event.KEY_RIGHT:case 4294967293:return"<right>";
case Event.KEY_DOWN:case 4294967291:return"<down>";case 46:return"<del>";case Event.KEY_PAGEUP:case 4294967286:return"<pgup>";case Event.KEY_PAGEDOWN:case 4294967285:return"<pgdown>";case Event.KEY_HOME:case 4294967284:return"<home>";case Event.KEY_END:case 4294967283:return"<end>";case 4294967279:return"<F1>";case 4294967278:return"<F2>";case 4294967277:return"<F3>";case 4294967276:return"<F4>";case 4294967275:return"<F5>";case 4294967274:return"<F6>";case 4294967273:return"<F7>";case 4294967272:return"<F8>";
case 4294967271:return"<F9>";case 4294967270:return"<F10>";case 4294967269:return"<F11>";case 4294967268:return"<F12>";default:return String.fromCharCode(c)}},undum:{oldContentLength:0,prepare:function(c){ifRecorder.command.input=c;this.oldContentLength=jQuery("#content").html().length},send:function(){var c=ifRecorder;c.inputcount++;c.output=jQuery("#content").html().substring(this.oldContentLength);c.send()}}};
jQuery(document).ready(function(c){c(document).bind("LineInput",function(a){ifRecorder.command=a;ifRecorder.inputcount++});c(document).bind("CharInput",function(a){ifRecorder.command=a;ifRecorder.command.input=ifRecorder.charName(a.input.keyCode);ifRecorder.inputcount++});c(document).bind("TextOutput",function(a){a.output.window==0&&ifRecorder.send(a.output.window,a.output.styles,a.output.text)});c(document).bind("GlkOutput",function(a){if(a.output!=undefined){for(var d=0;d<a.output.length;++d)for(var e=
0;e<a.output[d].text.length;++e){ifRecorder.styles="";ifRecorder.output="\n";if(typeof a.output[d].text[e].content!="undefined")for(var f=0;f<a.output[d].text[e].content.size();f+=2){ifRecorder.styles=a.output[d].text[e].content[f];ifRecorder.output=a.output[d].text[e].content[f+1];if(f==a.output[d].text[e].content.size()-2)ifRecorder.output+="\n";ifRecorder.send(ifRecorder.window,ifRecorder.styles,ifRecorder.output,true)}else ifRecorder.send(ifRecorder.window,ifRecorder.styles,ifRecorder.output,
true)}ifRecorder.sendCache()}});var b=function(){Console.prototype.renderHtml=function(){for(var a="",d="",e=0;e<this.height;e++){for(var f=null,g=0;g<this.width;g++){if(this._styles[e][g]!==f){if(f!==null){ifRecorder.send(1,f,d.replace(/\&nbsp\;/gi," "));d="";a+="</span>"}f=this._styles[e][g];if(f!==null)a+='<span class="'+f+'">'}a+=this._characters[e][g];d+=this._characters[e][g]}if(f!==null){a+="</span>";ifRecorder.send(1,f,d.replace(/\&nbsp\;/gi," ")+"\n");d=""}a+="<br/>"}return a};c(document).unbind("TextOutput",
b)};c(document).bind("TextOutput",b)}(jQuery));function getUrlVars(){for(var c=[],b,a=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),d=0;d<a.length;d++){b=a[d].split("=");c.push(b[0]);c[b[0]]=b[1]}return c};
